{{- if .Values.gateway }}
{{- required "`gateway` value has been deprecated.  Please use the new format in the `gateways` value." "" }}
{{- end }}

{{- range $name, $values := .Values.gateways }}
---
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: {{ $name }}
  namespace: {{ $.Release.Namespace }}
spec:
  selector:
    {{- $values.selector | default (dict) | toYaml | nindent 4 }}
  servers:
{{- range .servers }}
  - hosts:
{{- range .hosts }}
    - "{{ . }}"
{{- end }}
    port:
      name: {{ .port.name }}
      number: {{ .port.number }}
      protocol: {{ .port.protocol }}
{{- if .tls }}
    tls:
{{- if .tls.httpsRedirect }}
      httpsRedirect: {{ .tls.httpsRedirect }}
{{- end }}
{{- if .tls.mode }}
      mode: {{ .tls.mode }}
{{- end }}
{{- if .tls.credentialName }}
      credentialName: {{ .tls.credentialName }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}